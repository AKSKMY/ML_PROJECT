<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Model & Filters</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand">Admin Panel</a>
        <form action="/logout" method="post">
            <button class="btn btn-warning">Logout</button>
        </form>
    </nav>

    <div class="container">
        <h2 class="mt-4">Select Model & Data Filters</h2>

        <div class="alert alert-info mt-3" id="model-status-alert">
            Loading model information...
        </div>

        <!-- Select Machine Learning Model -->
        <form action="/update_model" method="post" class="mt-4">
            <label for="model">Choose a Machine Learning Model:</label>
            <select id="model" name="model" class="form-control">
                <!-- Options will be populated dynamically -->
            </select>
            <button type="submit" class="btn btn-primary mt-2">Save Model</button>
        </form>

        <!-- Select Filters to Show on User Page -->
        <form action="/admin" method="post" class="mt-4">
            <h4>Choose User Filters</h4>
            <label><input type="checkbox" name="license_class" {% if filters.license_class %}checked{% endif %}> License Class</label><br>
            <label><input type="checkbox" name="mileage_range" {% if filters.mileage_range %}checked{% endif %}> Mileage Range</label><br>
            <label><input type="checkbox" name="coe_left_range" {% if filters.coe_left_range %}checked{% endif %}> COE Left Range</label><br>
            <label><input type="checkbox" name="previous_owners" {% if filters.previous_owners %}checked{% endif %}> Number of Previous Owners</label><br>
            <button type="submit" class="btn btn-success mt-2">Save Filters</button>
        </form>

        <div class="mt-4">
            <h3>Model Dependencies</h3>
            <div class="card">
                <div class="card-body">
                    <h5>Required Python Packages:</h5>
                    <ul>
                        <li><strong>scikit-learn</strong>: Required for Random Forest models</li>
                        <li><strong>xgboost</strong>: Required for XGBoost models (Install: <code>pip install xgboost</code>)</li>
                        <li><strong>lightgbm</strong>: Required for LightGBM models (Install: <code>pip install lightgbm</code>)</li>
                        <li><strong>numpy</strong>: Required for all models</li>
                        <li><strong>joblib</strong>: Required for loading saved models</li>
                    </ul>
                    <p>If certain models do not appear in the dropdown, ensure their dependencies are installed.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load model status and dynamically populate the dropdown
        function loadModelStatus() {
            $.get("/model_status", function(data) {
                let availableModels = data.available_models || [];
                let selectedModel = data.selected_model || "";

                $("#model").empty();

                if (availableModels.length > 0) {
                    availableModels.forEach(function(model) {
                        let option = $("<option></option>")
                            .attr("value", model)
                            .text(model === "SVM" ? "Support Vector Machine" : model);

                        if (model === selectedModel) {
                            option.attr("selected", "selected");
                        }

                        $("#model").append(option);
                    });

                    $("#model-status-alert")
                        .removeClass("alert-info alert-warning alert-danger")
                        .addClass("alert-success")
                        .text(`${availableModels.length} models available. Currently using: ${selectedModel}`);
                } else {
                    $("#model-status-alert")
                        .removeClass("alert-info alert-success")
                        .addClass("alert-danger")
                        .text("No ML models could be loaded. Please check the dependencies.");
                }
            })
            .fail(function() {
                $("#model-status-alert")
                    .removeClass("alert-info alert-success")
                    .addClass("alert-danger")
                    .text("Error loading model information. Please check server logs.");
            });
        }

        $(document).ready(function() {
            loadModelStatus();
        });
    </script>
</body>
</html>
